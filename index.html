<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Sudoku Toolkit</title>
<link rel="icon" type="image/x-icon" href="favicon.ico">
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap" rel="stylesheet">
<link href="style.css" rel="stylesheet">
<link id="board-style" href="board-style.css" rel="stylesheet">
<script type="module">
let dvwDelta = 0;
let dvhDelta = 0;

function updateViewportUnits() {
    let newDvwDelta = (document.documentElement.clientWidth - window.innerWidth) / 100;
    if (newDvwDelta != dvwDelta) {
        dvwDelta = newDvwDelta;
        document.documentElement.style.setProperty('--dvw', `calc(1vw - ${dvwDelta}px)`);
    }
    let newDvhDelta = (document.documentElement.clientHeight - window.innerHeight) / 100;
    if (newDvhDelta != dvhDelta) {
        dvhDelta = newDvhDelta;
        document.documentElement.style.setProperty('--dvh', `calc(1vh - ${dvhDelta}px)`);
    }
}

window.addEventListener('load', () => {
    updateViewportUnits();
    window.addEventListener('resize', updateViewportUnits);
});
</script>
<script src="lz-string.min.js"></script>
<script type="module">
import { loadFromFPuzzles } from './puzzle.js';
import { createBoard } from './renderer.js';
import { startInput } from './input.js';
import { startTimer } from './timer.js';
import { check } from './check.js';
import { initCapture } from './capture.js';

window.addEventListener('load', () => {
    let fpuzzles = (new URL(window.location)).searchParams.get('fpuzzles');
    if (!fpuzzles) {
        fpuzzles = 'N4IgzglgXgpiBcBOANCA5gJwgEwQbT1DQgDcYA7ABQoGMIAbAWQEMMBrMBcgV3voF9kRUhWrk6TVhy68BQ9CKq0GLdp3g8+g4WSXiVU9Zrk7RyyWplb5xXWImrpG2doV3zjoy5uL7By87WpnoOhlYCALrIhG5m+hZOxq4kzPTccPAAjKi2FAgALhjpOb4eYYEmsSH+id7BfgleQVUNnuGuudWN7T7u8W0VHaX95Um9caEBSVExna2jdS1lU4tzy7XNayMrm8OTG5Vb+02HezUnQ33HPfXrFzO32weXE+c3S08X410DY4/Xg2+8x2pyub0B/3Bfw+AOm0Uh3QhMKhqzOiOhRxRzRSaQyACYSroCkUYITXujUWCKbsqb9KeS6TSGQstA9kdTQcyQS8fizObzuUC7u9MRyecDnkLPiK0YzIvD2XLxcKkaKlVLYfSBZKEerdXzldLVbKDWy1QaNVj+RKvvrBXadYqLQ7bSAcekEAAWMnkYnFJ32gPPM0mwPmsOhx3hqOR13RuOxmW051B+5RED5AAWMAwAFsAPa5mD5HP4UD0CDkGDqAggABKnoAwgBWECoBuNgBsbfrTYA7D2OwAOEARCKuCtVmt4XstwdNz2DgDMjaXo/H8kn1fwM47rfbC8Hzcbi/bndXR8bePnV5va7H/HTGAoACNmL74DEt9P65lb+28QvACT0HQDWwfdMAHdMwgMAAAccxrctK23T9dxXEdgIHds/0w+tAMQUDGxHCDUDYBh6BzGhmDQDIYhoGA+Bretj0I9N3QyEBu0fVBsAgAAzfic1oOjQAYpj8BYxtsKk7sNzExj6GYutjxkjsB3kkBxKUyS60AzIiOvdjUg9eAQDXVxtOU481wPC9jNxBAQEXHiQAwZh8ggfMyy0xTlKHYjBz7QLNKs3Tj33KTF1CvzdIC6922CozUA4pyLPkMLP3rYLIrrYLopSkzOJc9MAEduGYbAijgyifMy3c/1s38QOApq9JAhz0hrTIYokrL2u7LDly7YaNMK3EawJJdep0/qAragLT3rRAgOWjrxq6/BvWbZBOxm6zAvbVjB3PPC63PNiNtQvBO2QPtkCHZBEHHdM6AwGhas/BS+t3FaDPTN8wBgRsnIAYgAQUySHIZ7fNuHyLcQbM0GhwABgAUXRgAxLGe34/NyHyJGQFB1GyfJntIJwLMEFRgA6PEdpAbMIDQTN8lphnm0s2K5v/esAoM9sVoStb/tQQHgbB6GoaFkA4YRlDiZRjHsdx1B8cJ5XyYp1AqewGn4HpxnUBZtmOaNunuYy3nfv5ut4tHCXmCB5WZZh1AFcRsG0cxnG8YJomwZ1snKepzNOZN5mYFZ9mEGyEB3zQT7PW5p8YBofIk8++jbfrc8xpASXlZxvtmwAESar2lbBxtMnRodm0izWg+RkPUbDg2I8tqOzbjnvre+2bd2CtTgrk53XbB0uK6r+HveRuuG6bgOteDkPO8N+mmb7i3jcH3yfrWtSVsGgXpMHAKJ6Ll2peRmfK9h+ea8X+vG+bwPtY3vXw/jq3TZjubSOTNs4ZAALRLlRq5aitE6p5zrH+JaCC5w4RGsBJBgEz7tTUoBM6K4kEriwSuQuqUzIAAl0YABlKEAHkn6KyrF/HWq9W4k3biAHmR8Oxyw7KLFSddLzJTdEVJydZ6ELxJjjZhGtP7TyxmjUOnDh7ZQEYle2gtL63k6pxAA4uIl+bDUZSI7jItebdUYACEsaKJtlw/KQUUHnyQQFcCV0nIWP0Yw9eZN/amNYaTVGaN/auT4mAZgL5KLYHoPmYgNB8DpkKOkai5A+LYA8tWfMcFPIExrOmLcPlvw7manwwCbVAIYLnGOT2z8vGL1Rp2VGjYTEgH1lvOm3oQCwQAHIwEgo2HJhRmCVgtokmAE4UI/jrBhIialcJEUIsBEi6Zq61JJg0ppDTN7d3pkuVA3Ten9PIGAQZwy/RjPHEAA==';
    }
    let puzzle = loadFromFPuzzles(fpuzzles);
    
    // Add the board to the window object to simplify debugging.
    window.board = createBoard(puzzle);
    document.getElementById('board-container').appendChild(board);
    
    startInput(board, document.getElementById('input-panel'));
    startTimer(board, document.getElementById('timer-panel'), document.getElementById('pause-overlay'));
    
    let actionsPanel = document.getElementById('actions-panel');
    let checkButton = actionsPanel.querySelector('.check-button');
    checkButton.addEventListener('click', () => check(board));
    initCapture(board, document.getElementById('actions-panel'));
    
    let title = document.getElementById('title');
    title.textContent = puzzle.title;
    let author = document.getElementById('author');
    if (puzzle.author) {
        author.textContent = 'by ' + puzzle.author;
    }
    if (puzzle.rules.length > 0) {
        let rulesPanel = document.getElementById('rules-panel');
        rulesPanel.style.display = 'flex';
        let rules = rulesPanel.querySelector('.rules');
        for (let rule of puzzle.rules) {
            let ruleParagraph = document.createElement('p');
            ruleParagraph.textContent = rule;
            rules.appendChild(ruleParagraph);
        }
    }
});
</script>
</head>
<body>
<div class="content">
<div class="header">
<div id="title"></div>
<div id="author"></div>
</div>
<div id="pause-overlay">
<div class="pause-overlay-panel">Paused</div>
</div>
<div id="board-container"><noscript><div id="noscript">This page requires JavaScript.</div></noscript></div>
</div>
<div class="sidebar">
<div class="panel" id="timer-panel">
<div class="panel-row">
<button class="pause-button">&#9208;&#65038;</button>
<input class="timer-time" disabled value="0:00">
<button class="reset-button">&#11119;&#65038;</button>
</div>
</div>
<div class="panel" id="rules-panel">
<div class="rules-title">Rules:</div>
<div class="rules"></div>
</div>
<div class="panel panel-row" id="input-panel">
<div class="panel-column">
<div class="panel-column digit-panel">
<div class="panel-row">
<button class="digit-button">1</button>
<button class="digit-button">2</button>
<button class="digit-button">3</button>
</div>
<div class="panel-row">
<button class="digit-button">4</button>
<button class="digit-button">5</button>
<button class="digit-button">6</button>
</div>
<div class="panel-row">
<button class="digit-button">7</button>
<button class="digit-button">8</button>
<button class="digit-button">9</button>
</div>
</div>
<div class="panel-column corner-panel" style="display:none">
<div class="panel-row">
<button class="corner-button"><div>1</div></button>
<button class="corner-button"><div>2</div></button>
<button class="corner-button"><div>3</div></button>
</div>
<div class="panel-row">
<button class="corner-button"><div>4</div></button>
<button class="corner-button"><div>5</div></button>
<button class="corner-button"><div>6</div></button>
</div>
<div class="panel-row">
<button class="corner-button"><div>7</div></button>
<button class="corner-button"><div>8</div></button>
<button class="corner-button"><div>9</div></button>
</div>
</div>
<div class="panel-column center-panel" style="display:none">
<div class="panel-row">
<button class="center-button">1</button>
<button class="center-button">2</button>
<button class="center-button">3</button>
</div>
<div class="panel-row">
<button class="center-button">4</button>
<button class="center-button">5</button>
<button class="center-button">6</button>
</div>
<div class="panel-row">
<button class="center-button">7</button>
<button class="center-button">8</button>
<button class="center-button">9</button>
</div>
</div>
<div class="panel-column color-panel" style="display:none">
<div class="panel-row">
<button class="color-button"><div class="color-square-1">1</div></button>
<button class="color-button"><div class="color-square-2">2</div></button>
<button class="color-button"><div class="color-square-3">3</div></button>
</div>
<div class="panel-row">
<button class="color-button"><div class="color-square-4">4</div></button>
<button class="color-button"><div class="color-square-5">5</div></button>
<button class="color-button"><div class="color-square-6">6</div></button>
</div>
<div class="panel-row">
<button class="color-button"><div class="color-square-7">7</div></button>
<button class="color-button"><div class="color-square-8">8</div></button>
<button class="color-button"><div class="color-square-9">9</div></button>
</div>
</div>
<div class="panel-row">
<button class="undo-button"><div>&#10554;&#65038;</div></button>
<button class="redo-button"><div>&#10554;&#65038;</div></button>
<button class="delete-button">&#10006;&#65038;</button>
</div>
</div>
<div class="panel-column">
<button class="digit-mode-button"><div>5</div></button>
<button class="corner-mode-button toggle-off"><div>1 2<br>3 4</div></button>
<button class="center-mode-button toggle-off"><div>123</div></button>
<button class="color-mode-button toggle-off"><div>&#127752;</div></button>
</div>
</div>
<div class="panel" id="actions-panel">
<div class="panel-row">
<button class="check-button">Check</button>
<button class="capture-button">Screenshot</button>
</div>
</div>
</div>
</body>
</html>